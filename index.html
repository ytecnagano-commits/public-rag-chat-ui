<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Y-TEC トラブル解決BOT【ワイテッくん】</title>
  <link rel="stylesheet" href="./styles.css?v=21" />
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <img class="brand-avatar" src="./bot-avatar.jpg" alt="ワイテッくん" />
        <div class="brand-text">
          <div class="brand-title">Y-TEC トラブル解決BOT</div>
          <div class="brand-title2">【ワイテッくん】</div>
          <div class="brand-sub">役に立ったり立たなかったりするよ！</div>
        </div>
      </div>
      <button id="newChatBtn" class="btn btn-ghost" type="button">＋ 新しいチャット</button>

      
      <button id="toggleApiConfigBtn" class="btn btn-ghost btn-small" type="button" hidden>接続先設定</button>
      <div id="apiConfigWrap" hidden>
<div class="section-title">接続先</div>
      <div class="api-config">
        <input id="apiUrlInput" class="input" type="url" spellcheck="false" />
        <button id="saveApiUrlBtn" class="btn btn-ghost">保存</button>
        <div class="api-hint">※ /chat が 405 のときは Workers のURL（…workers.dev/chat）を入れてください</div>
      </div>

      </div>


      <div class="section-title">履歴（このブラウザ）</div>
      <div id="threadList" class="thread-list"></div>

      <div id="adminMetricsWrap" hidden>
      <div class="section-title">管理</div>
      <div class="metrics">
        <div class="metrics-row">
          <div class="metrics-label">Bucket</div>
      </div>
<div class="metrics-val" id="metricsBucket">-</div>
        </div>
        <div class="metrics-grid">
          <div class="metrics-card"><div class="k">req</div><div class="v" id="mReq">0</div></div>
          <div class="metrics-card"><div class="k">ok</div><div class="v" id="mOk">0</div></div>
          <div class="metrics-card"><div class="k">429</div><div class="v" id="mRl">0</div></div>
          <div class="metrics-card"><div class="k">err</div><div class="v" id="mErr">0</div></div>
        </div>
        <div class="metrics-updated">更新: <span id="metricsUpdated">-</span></div>
      </div>

      <div class="footer-note">Copyright (C) 2026- Y-TEC</div>
    </aside>

        <div id="sidebarBackdrop" class="backdrop" hidden></div>
<main class="main">
      <header class="topbar">
        <button id="menuBtn" class="btn btn-ghost btn-icon" type="button" title="履歴">≡</button>
        <div id="threadTitle" class="thread-title-top">新しいチャット</div>
        <div class="topbar-actions">
          <button id="copyBtn" class="btn btn-ghost" title="この会話をMarkdownでコピー" type="button">コピー</button>
          <button id="downloadBtn" class="btn btn-ghost" title="この会話をJSONで保存" type="button">DL</button>

          <div id="downloadMenu" class="menu-popup" hidden>
            <button class="menu-item" type="button" data-dl="json">.json で保存</button>
            <button class="menu-item" type="button" data-dl="txt">.txt で保存</button>
            <button class="menu-item" type="button" data-dl="csv">.csv で保存</button>
          </div>
          <button id="clearBtn" class="btn btn-ghost" type="button">この会話を消す</button>
        </div>
      </header>

      <section id="chat" class="chat"></section>

      <section class="composer">
        <div id="rateBanner" class="rate-banner" hidden>
          <div id="rateBannerText"></div>
          <label class="rate-toggle">
            <input id="rateAutoResend" type="checkbox" checked />
            解除後に自動で再送
          </label>
        </div>

        <div id="statusLine" class="status-line" hidden>
          <span id="statusText"></span>
        </div>

        <div class="composer-row">
          <textarea id="input" rows="1" placeholder="メッセージを入力…（Enterで送信 / Shift+Enterで改行）"></textarea>
          <button id="sendBtn" class="btn btn-primary">送信</button>
        </div>
      </section>
    </main>
  </div>

  <script src="./app.js?v=21"></script>

  <script>
  // v18: ensure mobile sidebar toggle works even if app.js is cached
  (function(){
    const menuBtn = document.getElementById("menuBtn");
    const sidebar = document.querySelector(".sidebar");
    const backdrop = document.getElementById("sidebarBackdrop");
    function setOpen(open){
      if(!sidebar || !backdrop) return;
      if(open){
        sidebar.classList.add("open");
        backdrop.hidden = false;
      } else {
        sidebar.classList.remove("open");
        backdrop.hidden = true;
      }
    }
    window.__toggleSidebar = function(){
      const open = sidebar && sidebar.classList.contains("open");
      setOpen(!open);
    };
    if(menuBtn){
      menuBtn.addEventListener("click", (e)=>{ e.preventDefault(); window.__toggleSidebar(); });
    }
    if(backdrop){
      backdrop.addEventListener("click", ()=>setOpen(false));
    }
    window.addEventListener("resize", ()=>{ if(window.matchMedia && !window.matchMedia("(max-width: 900px)").matches) setOpen(false); });
    // close by default
    setOpen(false);
  })();
  </script>
</body>
</html>
